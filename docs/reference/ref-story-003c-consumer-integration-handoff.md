---
type: reference
id: REF-story-003c-consumer-integration-handoff
title: Story 003c Consumer Integration Handoff
status: active
created: 2026-02-11
updated: 2026-02-11
owners:
  - platform
tags:
  - story-003c
  - integration
  - handoff
  - huledu
  - skriptoteket
links:
  - docs/backlog/stories/story-03-03-internal-backend-integration-huledu-skriptoteket.md
  - docs/backlog/tasks/task-06-define-thin-adapter-contract-and-conformance-harness-for-story-003c.md
  - docs/converters/internal_adapter_contract_v1.md
  - docs/converters/pdf_to_md_service_api_v1.md
  - docs/runbooks/runbook-hemma-devops-and-gpu.md
  - scripts/sir_convert_a_lot/integrations/adapter_profiles.py
  - tests/sir_convert_a_lot/test_integration_adapter_conformance.py
  - docs/backlog/tasks/task-07-establish-sir-convert-a-lot-hemma-deployment-readiness-and-tunnel-smoke-evidence-for-story-003c.md
---

## Purpose

Provide direct adoption guidance for consumer repositories while keeping this
repository as the canonical source for adapter contract semantics.

## Current Story 003c Artifacts in This Repo

- Normative adapter contract:
  - `docs/converters/internal_adapter_contract_v1.md`
- Reference adapter implementation:
  - `scripts/sir_convert_a_lot/integrations/adapter_profiles.py`
- Automated conformance harness:
  - `tests/sir_convert_a_lot/test_integration_adapter_conformance.py`

## Reference Adapter Usage

```python
from pathlib import Path

from scripts.sir_convert_a_lot.integrations.adapter_profiles import (
    AdapterRequestContext,
    ConsumerProfile,
    submit_pdf_for_profile,
)
from scripts.sir_convert_a_lot.interfaces.http_client import SirConvertALotClient

pdf_path = Path("/tmp/input.pdf")

context = AdapterRequestContext(
    profile=ConsumerProfile.HULEDU,
    pdf_path=pdf_path,
    source_label="huledu/inbound/input.pdf",
    caller_correlation_id=None,
    acceleration_policy="gpu_required",
    wait_seconds=0,
    max_poll_seconds=120.0,
)

with SirConvertALotClient(base_url="http://127.0.0.1:28085", api_key="...") as client:
    outcome = submit_pdf_for_profile(client=client, context=context)
    print(outcome.job_id, outcome.status)
```

## Required Environment and Transport Assumptions

- Consumer code calls canonical service endpoints only.
- Required header contract remains:
  - `X-API-Key`
  - `Idempotency-Key` (generated by adapter helper)
  - `X-Correlation-ID` (preserved or deterministic fallback)
- Tunnel-first local development is expected for Hemma:
  - `ssh hemma -L 28085:127.0.0.1:28085 -N`

## Do-Not-Fork Checklist

- Do not fork `JobSpec` schema by consumer profile.
- Do not remap service `error.code` or status values.
- Do not add conversion policy branches in consumer adapter layer.
- Do not bypass canonical client surfaces for ad hoc HTTP behavior.

## Consumer Adoption Checklist

1. Import adapter profile helpers from this repo or mirror exactly.
1. Bind profile explicitly (`huledu` or `skriptoteket`).
1. Route submit/poll/result via canonical v1 endpoints.
1. Preserve returned `job_id` for background completion workflows.
1. Run conformance scenarios against canonical service before merge.

## Validation and Smoke Flow

Primary gate (automated):

- `pdm run run-local-pdm pytest-root tests/sir_convert_a_lot/test_integration_adapter_conformance.py`

Supporting smoke path (manual, non-invasive):

1. Start/verify service on Hemma according to runbook.
1. Open local tunnel:
   - `ssh hemma -L 28085:127.0.0.1:28085 -N`
1. Submit sample file with adapter helper and verify:
   - `submit -> poll -> result` succeeds
   - correlation behavior and error propagation match contract

## Executed Smoke Notes (2026-02-11)

Captured evidence from this repository and Hemma host:

- Repo placement verified under canonical path:
  - `/home/paunchygent/apps/sir-convert-a-lot`
- Local tunnel health check:
  - `curl -i http://127.0.0.1:28085/healthz` -> `200 OK`, body `{"status":"ok"}`
- Adapter smoke via `adapter_profiles.py` through tunnel:
  - `submit -> poll -> result` succeeded
  - `job_id`: `job_0b5fa957472441f597883644d3`
  - `status`: `succeeded`
  - `correlation_id`: `corr_story003c_task07_smoke`
- Conformance harness remains green in:
  - `tests/sir_convert_a_lot/test_integration_adapter_conformance.py`

## Status Note

This repository contains the canonical contract and conformance harness for Story
003c slice 1. Consumer repo integration PRs are executed separately.
